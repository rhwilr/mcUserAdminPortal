var app = angular.module('mcUAP', [
    'ngResource',
    'ui.bootstrap',
    'ui.router.tabs',
    'ui.router',
    'cgBusy'
    ])


    .config(["$interpolateProvider", function ($interpolateProvider) {
        $interpolateProvider.startSymbol('[[');
        $interpolateProvider.endSymbol(']]');
    }])
    .value('cgBusyDefaults',{
        message:'Loading Data',
        backdrop: false,
        templateUrl: '/partials/common/angular-busy.html',
        delay: 0,
        minDuration: 100,
        wrapperClass: 'my-class my-class2'
    });
app.factory('RulesApi', ["$resource", function($resource){
    return $resource('/api/v1/rules/:id', {id:'@id'},
        {
            'agree': {
                method:'POST',
                url: "/api/v1/rules/agree"
            },
            'disagree': {
                method: 'POST',
                url: "/api/v1/rules/disagree"
            }
        });
    }]);
app.factory('ServersApi', ["$resource", function($resource){
    return $resource('/api/v1/server/:id', {id:'@id'},
        {
            'update': { method:'PUT' },
            'destroy': {method: 'DELETE'},
            'online': {
                method:'GET',
                url: "/api/v1/server/:id/online"
            },
            'updateWhitelist': {
                method:'GET',
                url: "/api/v1/server/:id/updateWhitelist"
            }
        });
    }]);
app.factory('UserApi', ["$resource", function($resource){
    return $resource('/api/v1/user/:id', {id:'@id'},
        {
            'update': {method: 'PUT', url: "/api/v1/user/:id/profile"},
            'destroy': {method: 'DELETE'},
            'updateProfile': { method:'PUT' },
            'updatePassword': { method:'PUT' },
            'updateMinecraft': { method:'PUT' },
            'me': {
                method:'GET',
                url: "/api/v1/user/me"
            },
            'meUpdateProfile': {
                method:'PUT',
                url: "/api/v1/user/me/profile"
            },
            'meUpdatePassword': {
                method:'PUT',
                url: "/api/v1/user/me/password"
            },
            'meUpdateMinecraft': {
                method:'PUT',
                url: "/api/v1/user/me/minecraft"
            },
            'patrons': {
                method: 'GET',
                url: "/api/v1/user/patrons"
            },
        });
    }]);
app.controller("AdminCtrl", ["$scope", function($scope) {

    $scope.tabData   = [
        {
            heading: 'Servers',
            route:   'servers'
        },
        {
            heading: 'Patrons',
            route: 'patrons'
        },
        {
            heading: 'Users',
            route:   'users'
        }
    ];


}]).config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    //
    // Now set up the states
    $stateProvider.state('servers', {
        url: '/servers',
        templateUrl: '/partials/admin/servers.html',
        controller: 'ServerIndexCtrl'
    })
        .state('servers.detail', {
            url: "^/servers/:id",
            views: {
                '@': {
                    templateUrl: '/partials/admin/servers.detail.html',
                    controller: 'ServerDetailCtrl'
                }
            }})
        .state('patrons', {
            url: '/patrons',
            templateUrl: '/partials/admin/patrons.html',
            controller: 'PatronIndexCtrl'
    })
        .state('users', {
        url: '/users',
            templateUrl: '/partials/admin/users.html',
            controller: 'UserIndexCtrl'
    });

}]);
app.controller("PatronIndexCtrl", ["$scope", "$modal", "$filter", "UserApi", function ($scope, $modal, $filter, UserApi) {

    var refreshData = function () {
        $scope.myPromise = UserApi.patrons(function (data) {
            $scope.resource = data.data;
            $scope.showTableContent = true;
        });
    };
    refreshData();

}]);
app.controller("ServerIndexCtrl", ["$scope", "$modal", "$filter", "ServersApi", function($scope, $modal, $filter, ServersApi) {

    var refreshData = function () {
        $scope.myPromise = ServersApi.get(function(data) {
            $scope.servers = data.data;
            $scope.showTableContent = true;
        });
    };
    refreshData();

    $scope.$watch('servers', function(newValue, oldValue) {
        angular.forEach($scope.servers, function(server){
            ServersApi.online({id:server.id},function(data) {
                server.online = data.data;
            });

        });

    });

    $scope.open = function (serverEditID) {
        var modalInstance = $modal.open({
            templateUrl: 'AddServerModal.html',
            controller: 'ModalInstanceCtrl',
            resolve: {
                ResourcesApi: function () {
                    return  ServersApi;
                },
                recordID: function () {
                    return  serverEditID;
                }
            }
        });

        modalInstance.result.then(function (data) {
            refreshData();
        }, function () {
        });
    };

}]);
app.controller("ServerDetailCtrl", ["$scope", "$state", "$stateParams", "$filter", "ServersApi", function($scope, $state, $stateParams, $filter, ServersApi) {

    $scope.myPromise =  ServersApi.get({id:$stateParams.id}, function(data) {
        $scope.resource = data.data;

        ServersApi.online({id: $scope.resource.id}, function (data) {
            $scope.resource.online = data.data;
        });
    });


    $scope.destroy = function () {
        ServersApi.destroy({id: $scope.resource.id}, function (data) {
        });

    };

    $scope.whitelist = function () {
        ServersApi.updateWhitelist({id: $scope.resource.id}, function (data) {
        });

    };



}]);
app.controller("UserIndexCtrl", ["$scope", "$modal", "$filter", "UserApi", function ($scope, $modal, $filter, UserApi) {

    var refreshData = function () {
        $scope.myPromise = UserApi.get(function (data) {
            $scope.resource = data.data;
            $scope.showTableContent = true;
        });
    };
    refreshData();

    $scope.open = function (UserEditID) {
        var modalInstance = $modal.open({
            templateUrl: 'AddUserModal.html',
            controller: 'ModalInstanceCtrl',
            resolve: {
                ResourcesApi: function () {
                    return UserApi;
                },
                recordID: function () {
                    return UserEditID;
                }
            }
        });

        modalInstance.result.then(function (data) {
            refreshData();
        }, function () {
        });
    };

}]);
app.controller('ModalInstanceCtrl', ["$scope", "$modalInstance", "ResourcesApi", "recordID", function ($scope, $modalInstance, ResourcesApi, recordID) {

    if (recordID) {
        $scope.myPromise =  ResourcesApi.get({id:recordID}, function(data) {
            $scope.resource = data.data;
            $scope.showModalContent = true;
        });
    }
    else {
        $scope.showModalContent = true;
    }

    $scope.ok = function () {
        if(recordID){
            ResourcesApi.update({ id:$scope.resource.id }, $scope.resource, function(res) {
                $modalInstance.close($scope.resource);
            }, function(res) {
                $scope.errorResponse = res.data.error.message;
            });
        } else {
            console.log("2");
            ResourcesApi.save( $scope.resource, function(res) {
                $modalInstance.close($scope.resource);
            }, function(res) {
                $scope.errorResponse = res.data.error.message;
            });
        }

    };

    $scope.cancel = function () {
        $modalInstance.dismiss('cancel');
    };
}]);
app.controller("DashboardCtrl", ["$scope", "$modal", "$filter", "ServersApi", function ($scope, $modal, $filter, ServersApi) {


    var refreshData = function () {
        $scope.myPromise = ServersApi.get(function (data) {
            $scope.servers = data.data;
            $scope.showTableContent = true;
        });
    };
    refreshData();

    $scope.$watch('servers', function (newValue, oldValue) {
        angular.forEach($scope.servers, function (server) {
            ServersApi.online({id: server.id}, function (data) {
                server.online = data.data;
            });

        });

    });


}]);
app.controller("RulesCtrl", ["$scope", "$modal", "$filter", "RulesApi", function ($scope, $modal, $filter, RulesApi) {


    var refreshData = function () {
        $scope.myPromise = RulesApi.get(function (data) {
            $scope.user = data.data;
        });
    };
    refreshData();


    $scope.changeRules = function() {

        if ($scope.user.rules_agreed){
            RulesApi.agree($scope.resource, function(res) {
            }, function(res) {
            });
        } else {
            RulesApi.disagree($scope.resource, function(res) {
            }, function(res) {
            });
        }

    };


}]);
app.controller("MinecraftIndexCtrl", ["$scope", "$modal", "$filter", "UserApi", function($scope, $modal, $filter, UserApi) {

    var refreshData = function () {
        $scope.myPromise = UserApi.me(function(data) {
            $scope.resource = data.data;
            $scope.showTableContent = true;
        });
    };
    refreshData();

    $scope.saveMinecraft = function () {
        UserApi.meUpdateMinecraft($scope.resource, function(res) {
            $scope.successMinecraftResponse = res;
            $scope.errorResponse = null;
        }, function(res) {
            $scope.errorResponse = res.data.error.message;
        });
    };


}]);
app.controller("ProfileCtrl", ["$scope", function($scope) {

    $scope.tabData   = [
        {
            heading: 'Profile',
            route:   'profile'
        },
        {
            heading: 'Minecraft',
            route:   'minecraft'
        }
    ];


}]).config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    //
    // For any unmatched url, redirect to /state1
    $urlRouterProvider.otherwise("/profile");
    //
    // Now set up the states
    $stateProvider.state('profile', {
        url: '/profile',
        templateUrl: '/partials/profile/profile.html'
    }).state('minecraft', {
        url: '/minecraft',
        templateUrl: '/partials/profile/minecraft.html'
    });

}]);
app.controller("ProfileIndexCtrl", ["$scope", "$modal", "$filter", "UserApi", function($scope, $modal, $filter, UserApi) {

    var refreshData = function () {
        $scope.myPromise = UserApi.me(function(data) {
            $scope.resource = data.data;
            $scope.showTableContent = true;
        });
    };
    refreshData();

    $scope.saveProfile = function () {
        UserApi.meUpdateProfile($scope.resource, function(res) {
            $scope.successProfileResponse = res;
            $scope.errorResponse = null;
        }, function(res) {
            $scope.errorResponse = res.data.error.message;
        });
    };

    $scope.savePassword = function () {
        UserApi.meUpdatePassword($scope.resource, function(res) {
            $scope.successPasswordResponse = res;
            $scope.errorResponse = null;
        }, function(res) {
            $scope.errorResponse = res.data.error.message;
        });
    };


}]);
app.controller('NavbarInstanceCtrl', ["$scope", function ($scope) {
}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIlNlcnZpY2VzXFxSdWxlc1NlcnZpY2UuanMiLCJTZXJ2aWNlc1xcU2VydmVyU2VydmljZS5qcyIsIlNlcnZpY2VzXFxVc2VyU2VydmljZS5qcyIsIkNvbnRyb2xsZXJzXFxBZG1pbmlzdHJhdGlvblxcQWRtaW5pc3RyYXRpb25Db250cm9sbGVyLmpzIiwiQ29udHJvbGxlcnNcXEFkbWluaXN0cmF0aW9uXFxQYXRyb25Db250cm9sbGVyLmpzIiwiQ29udHJvbGxlcnNcXEFkbWluaXN0cmF0aW9uXFxTZXJ2ZXJDb250cm9sbGVyLmpzIiwiQ29udHJvbGxlcnNcXEFkbWluaXN0cmF0aW9uXFxTZXJ2ZXJEZXRhaWxDb250cm9sbGVyLmpzIiwiQ29udHJvbGxlcnNcXEFkbWluaXN0cmF0aW9uXFxVc2VyQ29udHJvbGxlci5qcyIsIkNvbnRyb2xsZXJzXFxDb21tb25cXE1vZGFsc0NvbnRyb2xsZXIuanMiLCJDb250cm9sbGVyc1xcRGFzaGJvYXJkXFxEYXNoYm9hcmRDb250cm9sbGVyLmpzIiwiQ29udHJvbGxlcnNcXFBhZ2VzXFxSdWxlc0NvbnRyb2xsZXIuanMiLCJDb250cm9sbGVyc1xcUHJvZmlsZVxcTWluZWNyYWZ0SW5kZXhDdHJsLmpzIiwiQ29udHJvbGxlcnNcXFByb2ZpbGVcXFByb2ZpbGVDb250cm9sbGVyLmpzIiwiQ29udHJvbGxlcnNcXFByb2ZpbGVcXFByb2ZpbGVJbmRleEN0cmwuanMiLCJDb250cm9sbGVyc1xcUmVnaW9uc1xcTmF2YmFyQ29udHJvbGxlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNaQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNkQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3QkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ1ZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUN4Q0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ3pCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzlCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQ2pDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FDdEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzFCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUNwQkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQzVCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUM3QkE7QUFDQSIsImZpbGUiOiJhcHAubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGFwcCA9IGFuZ3VsYXIubW9kdWxlKCdtY1VBUCcsIFtcclxuICAgICduZ1Jlc291cmNlJyxcclxuICAgICd1aS5ib290c3RyYXAnLFxyXG4gICAgJ3VpLnJvdXRlci50YWJzJyxcclxuICAgICd1aS5yb3V0ZXInLFxyXG4gICAgJ2NnQnVzeSdcclxuICAgIF0pXHJcblxyXG5cclxuICAgIC5jb25maWcoZnVuY3Rpb24gKCRpbnRlcnBvbGF0ZVByb3ZpZGVyKSB7XHJcbiAgICAgICAgJGludGVycG9sYXRlUHJvdmlkZXIuc3RhcnRTeW1ib2woJ1tbJyk7XHJcbiAgICAgICAgJGludGVycG9sYXRlUHJvdmlkZXIuZW5kU3ltYm9sKCddXScpO1xyXG4gICAgfSlcclxuICAgIC52YWx1ZSgnY2dCdXN5RGVmYXVsdHMnLHtcclxuICAgICAgICBtZXNzYWdlOidMb2FkaW5nIERhdGEnLFxyXG4gICAgICAgIGJhY2tkcm9wOiBmYWxzZSxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9jb21tb24vYW5ndWxhci1idXN5Lmh0bWwnLFxyXG4gICAgICAgIGRlbGF5OiAwLFxyXG4gICAgICAgIG1pbkR1cmF0aW9uOiAxMDAsXHJcbiAgICAgICAgd3JhcHBlckNsYXNzOiAnbXktY2xhc3MgbXktY2xhc3MyJ1xyXG4gICAgfSk7IiwiYXBwLmZhY3RvcnkoJ1J1bGVzQXBpJywgZnVuY3Rpb24oJHJlc291cmNlKXtcclxuICAgIHJldHVybiAkcmVzb3VyY2UoJy9hcGkvdjEvcnVsZXMvOmlkJywge2lkOidAaWQnfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgICdhZ3JlZSc6IHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDonUE9TVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IFwiL2FwaS92MS9ydWxlcy9hZ3JlZVwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdkaXNhZ3JlZSc6IHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ1BPU1QnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBcIi9hcGkvdjEvcnVsZXMvZGlzYWdyZWVcIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTsiLCJhcHAuZmFjdG9yeSgnU2VydmVyc0FwaScsIGZ1bmN0aW9uKCRyZXNvdXJjZSl7XHJcbiAgICByZXR1cm4gJHJlc291cmNlKCcvYXBpL3YxL3NlcnZlci86aWQnLCB7aWQ6J0BpZCd9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgJ3VwZGF0ZSc6IHsgbWV0aG9kOidQVVQnIH0sXHJcbiAgICAgICAgICAgICdkZXN0cm95Jzoge21ldGhvZDogJ0RFTEVURSd9LFxyXG4gICAgICAgICAgICAnb25saW5lJzoge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOidHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBcIi9hcGkvdjEvc2VydmVyLzppZC9vbmxpbmVcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAndXBkYXRlV2hpdGVsaXN0Jzoge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOidHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBcIi9hcGkvdjEvc2VydmVyLzppZC91cGRhdGVXaGl0ZWxpc3RcIlxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9KTsiLCJhcHAuZmFjdG9yeSgnVXNlckFwaScsIGZ1bmN0aW9uKCRyZXNvdXJjZSl7XHJcbiAgICByZXR1cm4gJHJlc291cmNlKCcvYXBpL3YxL3VzZXIvOmlkJywge2lkOidAaWQnfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgICd1cGRhdGUnOiB7bWV0aG9kOiAnUFVUJywgdXJsOiBcIi9hcGkvdjEvdXNlci86aWQvcHJvZmlsZVwifSxcclxuICAgICAgICAgICAgJ2Rlc3Ryb3knOiB7bWV0aG9kOiAnREVMRVRFJ30sXHJcbiAgICAgICAgICAgICd1cGRhdGVQcm9maWxlJzogeyBtZXRob2Q6J1BVVCcgfSxcclxuICAgICAgICAgICAgJ3VwZGF0ZVBhc3N3b3JkJzogeyBtZXRob2Q6J1BVVCcgfSxcclxuICAgICAgICAgICAgJ3VwZGF0ZU1pbmVjcmFmdCc6IHsgbWV0aG9kOidQVVQnIH0sXHJcbiAgICAgICAgICAgICdtZSc6IHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDonR0VUJyxcclxuICAgICAgICAgICAgICAgIHVybDogXCIvYXBpL3YxL3VzZXIvbWVcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnbWVVcGRhdGVQcm9maWxlJzoge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOidQVVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBcIi9hcGkvdjEvdXNlci9tZS9wcm9maWxlXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ21lVXBkYXRlUGFzc3dvcmQnOiB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6J1BVVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IFwiL2FwaS92MS91c2VyL21lL3Bhc3N3b3JkXCJcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ21lVXBkYXRlTWluZWNyYWZ0Jzoge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOidQVVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBcIi9hcGkvdjEvdXNlci9tZS9taW5lY3JhZnRcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAncGF0cm9ucyc6IHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDogJ0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IFwiL2FwaS92MS91c2VyL3BhdHJvbnNcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7IiwiYXBwLmNvbnRyb2xsZXIoXCJBZG1pbkN0cmxcIiwgZnVuY3Rpb24oJHNjb3BlKSB7XHJcblxyXG4gICAgJHNjb3BlLnRhYkRhdGEgICA9IFtcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGhlYWRpbmc6ICdTZXJ2ZXJzJyxcclxuICAgICAgICAgICAgcm91dGU6ICAgJ3NlcnZlcnMnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGhlYWRpbmc6ICdQYXRyb25zJyxcclxuICAgICAgICAgICAgcm91dGU6ICdwYXRyb25zJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoZWFkaW5nOiAnVXNlcnMnLFxyXG4gICAgICAgICAgICByb3V0ZTogICAndXNlcnMnXHJcbiAgICAgICAgfVxyXG4gICAgXTtcclxuXHJcblxyXG59KS5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAgLy9cclxuICAgIC8vIE5vdyBzZXQgdXAgdGhlIHN0YXRlc1xyXG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3NlcnZlcnMnLCB7XHJcbiAgICAgICAgdXJsOiAnL3NlcnZlcnMnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3NlcnZlcnMuaHRtbCcsXHJcbiAgICAgICAgY29udHJvbGxlcjogJ1NlcnZlckluZGV4Q3RybCdcclxuICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdzZXJ2ZXJzLmRldGFpbCcsIHtcclxuICAgICAgICAgICAgdXJsOiBcIl4vc2VydmVycy86aWRcIixcclxuICAgICAgICAgICAgdmlld3M6IHtcclxuICAgICAgICAgICAgICAgICdAJzoge1xyXG4gICAgICAgICAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3NlcnZlcnMuZGV0YWlsLmh0bWwnLFxyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdTZXJ2ZXJEZXRhaWxDdHJsJ1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9fSlcclxuICAgICAgICAuc3RhdGUoJ3BhdHJvbnMnLCB7XHJcbiAgICAgICAgICAgIHVybDogJy9wYXRyb25zJyxcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYWRtaW4vcGF0cm9ucy5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1BhdHJvbkluZGV4Q3RybCdcclxuICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCd1c2VycycsIHtcclxuICAgICAgICB1cmw6ICcvdXNlcnMnLFxyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9hZG1pbi91c2Vycy5odG1sJyxcclxuICAgICAgICAgICAgY29udHJvbGxlcjogJ1VzZXJJbmRleEN0cmwnXHJcbiAgICB9KTtcclxuXHJcbn0pOyIsImFwcC5jb250cm9sbGVyKFwiUGF0cm9uSW5kZXhDdHJsXCIsIGZ1bmN0aW9uICgkc2NvcGUsICRtb2RhbCwgJGZpbHRlciwgVXNlckFwaSkge1xyXG5cclxuICAgIHZhciByZWZyZXNoRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkc2NvcGUubXlQcm9taXNlID0gVXNlckFwaS5wYXRyb25zKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNvdXJjZSA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dUYWJsZUNvbnRlbnQgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJlZnJlc2hEYXRhKCk7XHJcblxyXG59KTsiLCJhcHAuY29udHJvbGxlcihcIlNlcnZlckluZGV4Q3RybFwiLCBmdW5jdGlvbigkc2NvcGUsICRtb2RhbCwgJGZpbHRlciwgU2VydmVyc0FwaSkge1xyXG5cclxuICAgIHZhciByZWZyZXNoRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkc2NvcGUubXlQcm9taXNlID0gU2VydmVyc0FwaS5nZXQoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuc2VydmVycyA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dUYWJsZUNvbnRlbnQgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJlZnJlc2hEYXRhKCk7XHJcblxyXG4gICAgJHNjb3BlLiR3YXRjaCgnc2VydmVycycsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUuc2VydmVycywgZnVuY3Rpb24oc2VydmVyKXtcclxuICAgICAgICAgICAgU2VydmVyc0FwaS5vbmxpbmUoe2lkOnNlcnZlci5pZH0sZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgc2VydmVyLm9ubGluZSA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS5vcGVuID0gZnVuY3Rpb24gKHNlcnZlckVkaXRJRCkge1xyXG4gICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ0FkZFNlcnZlck1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTW9kYWxJbnN0YW5jZUN0cmwnLFxyXG4gICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICBSZXNvdXJjZXNBcGk6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIFNlcnZlcnNBcGk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVjb3JkSUQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIHNlcnZlckVkaXRJRDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJlZnJlc2hEYXRhKCk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbn0pOyIsImFwcC5jb250cm9sbGVyKFwiU2VydmVyRGV0YWlsQ3RybFwiLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkZmlsdGVyLCBTZXJ2ZXJzQXBpKSB7XHJcblxyXG4gICAgJHNjb3BlLm15UHJvbWlzZSA9ICBTZXJ2ZXJzQXBpLmdldCh7aWQ6JHN0YXRlUGFyYW1zLmlkfSwgZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICRzY29wZS5yZXNvdXJjZSA9IGRhdGEuZGF0YTtcclxuXHJcbiAgICAgICAgU2VydmVyc0FwaS5vbmxpbmUoe2lkOiAkc2NvcGUucmVzb3VyY2UuaWR9LCBmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzb3VyY2Uub25saW5lID0gZGF0YS5kYXRhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG5cclxuICAgICRzY29wZS5kZXN0cm95ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIFNlcnZlcnNBcGkuZGVzdHJveSh7aWQ6ICRzY29wZS5yZXNvdXJjZS5pZH0sIGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgfTtcclxuXHJcbiAgICAkc2NvcGUud2hpdGVsaXN0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIFNlcnZlcnNBcGkudXBkYXRlV2hpdGVsaXN0KHtpZDogJHNjb3BlLnJlc291cmNlLmlkfSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9O1xyXG5cclxuXHJcblxyXG59KTsiLCJhcHAuY29udHJvbGxlcihcIlVzZXJJbmRleEN0cmxcIiwgZnVuY3Rpb24gKCRzY29wZSwgJG1vZGFsLCAkZmlsdGVyLCBVc2VyQXBpKSB7XHJcblxyXG4gICAgdmFyIHJlZnJlc2hEYXRhID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRzY29wZS5teVByb21pc2UgPSBVc2VyQXBpLmdldChmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzb3VyY2UgPSBkYXRhLmRhdGE7XHJcbiAgICAgICAgICAgICRzY29wZS5zaG93VGFibGVDb250ZW50ID0gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZWZyZXNoRGF0YSgpO1xyXG5cclxuICAgICRzY29wZS5vcGVuID0gZnVuY3Rpb24gKFVzZXJFZGl0SUQpIHtcclxuICAgICAgICB2YXIgbW9kYWxJbnN0YW5jZSA9ICRtb2RhbC5vcGVuKHtcclxuICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICdBZGRVc2VyTW9kYWwuaHRtbCcsXHJcbiAgICAgICAgICAgIGNvbnRyb2xsZXI6ICdNb2RhbEluc3RhbmNlQ3RybCcsXHJcbiAgICAgICAgICAgIHJlc29sdmU6IHtcclxuICAgICAgICAgICAgICAgIFJlc291cmNlc0FwaTogZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBVc2VyQXBpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIHJlY29yZElEOiBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFVzZXJFZGl0SUQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgbW9kYWxJbnN0YW5jZS5yZXN1bHQudGhlbihmdW5jdGlvbiAoZGF0YSkge1xyXG4gICAgICAgICAgICByZWZyZXNoRGF0YSgpO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG59KTsiLCJhcHAuY29udHJvbGxlcignTW9kYWxJbnN0YW5jZUN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlLCAkbW9kYWxJbnN0YW5jZSwgUmVzb3VyY2VzQXBpLCByZWNvcmRJRCkge1xyXG5cclxuICAgIGlmIChyZWNvcmRJRCkge1xyXG4gICAgICAgICRzY29wZS5teVByb21pc2UgPSAgUmVzb3VyY2VzQXBpLmdldCh7aWQ6cmVjb3JkSUR9LCBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNvdXJjZSA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dNb2RhbENvbnRlbnQgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgJHNjb3BlLnNob3dNb2RhbENvbnRlbnQgPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgICRzY29wZS5vayA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBpZihyZWNvcmRJRCl7XHJcbiAgICAgICAgICAgIFJlc291cmNlc0FwaS51cGRhdGUoeyBpZDokc2NvcGUucmVzb3VyY2UuaWQgfSwgJHNjb3BlLnJlc291cmNlLCBmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgICAgICRtb2RhbEluc3RhbmNlLmNsb3NlKCRzY29wZS5yZXNvdXJjZSk7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgICAgJHNjb3BlLmVycm9yUmVzcG9uc2UgPSByZXMuZGF0YS5lcnJvci5tZXNzYWdlO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZyhcIjJcIik7XHJcbiAgICAgICAgICAgIFJlc291cmNlc0FwaS5zYXZlKCAkc2NvcGUucmVzb3VyY2UsIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuY2xvc2UoJHNjb3BlLnJlc291cmNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JSZXNwb25zZSA9IHJlcy5kYXRhLmVycm9yLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJG1vZGFsSW5zdGFuY2UuZGlzbWlzcygnY2FuY2VsJyk7XHJcbiAgICB9O1xyXG59KTsiLCJhcHAuY29udHJvbGxlcihcIkRhc2hib2FyZEN0cmxcIiwgZnVuY3Rpb24gKCRzY29wZSwgJG1vZGFsLCAkZmlsdGVyLCBTZXJ2ZXJzQXBpKSB7XHJcblxyXG5cclxuICAgIHZhciByZWZyZXNoRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkc2NvcGUubXlQcm9taXNlID0gU2VydmVyc0FwaS5nZXQoZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnNlcnZlcnMgPSBkYXRhLmRhdGE7XHJcbiAgICAgICAgICAgICRzY29wZS5zaG93VGFibGVDb250ZW50ID0gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZWZyZXNoRGF0YSgpO1xyXG5cclxuICAgICRzY29wZS4kd2F0Y2goJ3NlcnZlcnMnLCBmdW5jdGlvbiAobmV3VmFsdWUsIG9sZFZhbHVlKSB7XHJcbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKCRzY29wZS5zZXJ2ZXJzLCBmdW5jdGlvbiAoc2VydmVyKSB7XHJcbiAgICAgICAgICAgIFNlcnZlcnNBcGkub25saW5lKHtpZDogc2VydmVyLmlkfSwgZnVuY3Rpb24gKGRhdGEpIHtcclxuICAgICAgICAgICAgICAgIHNlcnZlci5vbmxpbmUgPSBkYXRhLmRhdGE7XHJcbiAgICAgICAgICAgIH0pO1xyXG5cclxuICAgICAgICB9KTtcclxuXHJcbiAgICB9KTtcclxuXHJcblxyXG59KTsiLCJhcHAuY29udHJvbGxlcihcIlJ1bGVzQ3RybFwiLCBmdW5jdGlvbiAoJHNjb3BlLCAkbW9kYWwsICRmaWx0ZXIsIFJ1bGVzQXBpKSB7XHJcblxyXG5cclxuICAgIHZhciByZWZyZXNoRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkc2NvcGUubXlQcm9taXNlID0gUnVsZXNBcGkuZ2V0KGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgICRzY29wZS51c2VyID0gZGF0YS5kYXRhO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJlZnJlc2hEYXRhKCk7XHJcblxyXG5cclxuICAgICRzY29wZS5jaGFuZ2VSdWxlcyA9IGZ1bmN0aW9uKCkge1xyXG5cclxuICAgICAgICBpZiAoJHNjb3BlLnVzZXIucnVsZXNfYWdyZWVkKXtcclxuICAgICAgICAgICAgUnVsZXNBcGkuYWdyZWUoJHNjb3BlLnJlc291cmNlLCBmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIFJ1bGVzQXBpLmRpc2FncmVlKCRzY29wZS5yZXNvdXJjZSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgIH0sIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgfTtcclxuXHJcblxyXG59KTsiLCJhcHAuY29udHJvbGxlcihcIk1pbmVjcmFmdEluZGV4Q3RybFwiLCBmdW5jdGlvbigkc2NvcGUsICRtb2RhbCwgJGZpbHRlciwgVXNlckFwaSkge1xyXG5cclxuICAgIHZhciByZWZyZXNoRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkc2NvcGUubXlQcm9taXNlID0gVXNlckFwaS5tZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNvdXJjZSA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dUYWJsZUNvbnRlbnQgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJlZnJlc2hEYXRhKCk7XHJcblxyXG4gICAgJHNjb3BlLnNhdmVNaW5lY3JhZnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgVXNlckFwaS5tZVVwZGF0ZU1pbmVjcmFmdCgkc2NvcGUucmVzb3VyY2UsIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAkc2NvcGUuc3VjY2Vzc01pbmVjcmFmdFJlc3BvbnNlID0gcmVzO1xyXG4gICAgICAgICAgICAkc2NvcGUuZXJyb3JSZXNwb25zZSA9IG51bGw7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5lcnJvclJlc3BvbnNlID0gcmVzLmRhdGEuZXJyb3IubWVzc2FnZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG5cclxufSk7IiwiYXBwLmNvbnRyb2xsZXIoXCJQcm9maWxlQ3RybFwiLCBmdW5jdGlvbigkc2NvcGUpIHtcclxuXHJcbiAgICAkc2NvcGUudGFiRGF0YSAgID0gW1xyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaGVhZGluZzogJ1Byb2ZpbGUnLFxyXG4gICAgICAgICAgICByb3V0ZTogICAncHJvZmlsZSdcclxuICAgICAgICB9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgaGVhZGluZzogJ01pbmVjcmFmdCcsXHJcbiAgICAgICAgICAgIHJvdXRlOiAgICdtaW5lY3JhZnQnXHJcbiAgICAgICAgfVxyXG4gICAgXTtcclxuXHJcblxyXG59KS5jb25maWcoZnVuY3Rpb24oJHN0YXRlUHJvdmlkZXIsICR1cmxSb3V0ZXJQcm92aWRlcikge1xyXG4gICAgLy9cclxuICAgIC8vIEZvciBhbnkgdW5tYXRjaGVkIHVybCwgcmVkaXJlY3QgdG8gL3N0YXRlMVxyXG4gICAgJHVybFJvdXRlclByb3ZpZGVyLm90aGVyd2lzZShcIi9wcm9maWxlXCIpO1xyXG4gICAgLy9cclxuICAgIC8vIE5vdyBzZXQgdXAgdGhlIHN0YXRlc1xyXG4gICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ3Byb2ZpbGUnLCB7XHJcbiAgICAgICAgdXJsOiAnL3Byb2ZpbGUnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL3Byb2ZpbGUvcHJvZmlsZS5odG1sJ1xyXG4gICAgfSkuc3RhdGUoJ21pbmVjcmFmdCcsIHtcclxuICAgICAgICB1cmw6ICcvbWluZWNyYWZ0JyxcclxuICAgICAgICB0ZW1wbGF0ZVVybDogJy9wYXJ0aWFscy9wcm9maWxlL21pbmVjcmFmdC5odG1sJ1xyXG4gICAgfSk7XHJcblxyXG59KTsiLCJhcHAuY29udHJvbGxlcihcIlByb2ZpbGVJbmRleEN0cmxcIiwgZnVuY3Rpb24oJHNjb3BlLCAkbW9kYWwsICRmaWx0ZXIsIFVzZXJBcGkpIHtcclxuXHJcbiAgICB2YXIgcmVmcmVzaERhdGEgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgJHNjb3BlLm15UHJvbWlzZSA9IFVzZXJBcGkubWUoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAkc2NvcGUucmVzb3VyY2UgPSBkYXRhLmRhdGE7XHJcbiAgICAgICAgICAgICRzY29wZS5zaG93VGFibGVDb250ZW50ID0gdHJ1ZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcbiAgICByZWZyZXNoRGF0YSgpO1xyXG5cclxuICAgICRzY29wZS5zYXZlUHJvZmlsZSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBVc2VyQXBpLm1lVXBkYXRlUHJvZmlsZSgkc2NvcGUucmVzb3VyY2UsIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAkc2NvcGUuc3VjY2Vzc1Byb2ZpbGVSZXNwb25zZSA9IHJlcztcclxuICAgICAgICAgICAgJHNjb3BlLmVycm9yUmVzcG9uc2UgPSBudWxsO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAkc2NvcGUuZXJyb3JSZXNwb25zZSA9IHJlcy5kYXRhLmVycm9yLm1lc3NhZ2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuICAgICRzY29wZS5zYXZlUGFzc3dvcmQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgVXNlckFwaS5tZVVwZGF0ZVBhc3N3b3JkKCRzY29wZS5yZXNvdXJjZSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5zdWNjZXNzUGFzc3dvcmRSZXNwb25zZSA9IHJlcztcclxuICAgICAgICAgICAgJHNjb3BlLmVycm9yUmVzcG9uc2UgPSBudWxsO1xyXG4gICAgICAgIH0sIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAkc2NvcGUuZXJyb3JSZXNwb25zZSA9IHJlcy5kYXRhLmVycm9yLm1lc3NhZ2U7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG5cclxuXHJcbn0pOyIsImFwcC5jb250cm9sbGVyKCdOYXZiYXJJbnN0YW5jZUN0cmwnLCBmdW5jdGlvbiAoJHNjb3BlKSB7XHJcbn0pOyJdLCJzb3VyY2VSb290IjoiL3NvdXJjZS8ifQ==