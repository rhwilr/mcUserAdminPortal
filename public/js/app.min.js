var app = angular.module('mcUAP', [
    'ngResource',
    'ui.bootstrap',
    'ui.router.tabs',
    'ui.router',
    'cgBusy'
    ])


    .config(["$interpolateProvider", function ($interpolateProvider) {
        $interpolateProvider.startSymbol('[[');
        $interpolateProvider.endSymbol(']]');
    }])
    .value('cgBusyDefaults',{
        message:'Loading Data',
        backdrop: false,
        templateUrl: '/partials/common/angular-busy.html',
        delay: 0,
        minDuration: 100,
        wrapperClass: 'my-class my-class2'
    });
app.factory('ServersApi', ["$resource", function($resource){
    return $resource('/api/v1/server/:id', {id:'@id'},
        {
            'update': { method:'PUT' },
            'online': {
                method:'GET',
                url: "/api/v1/server/:id/online"
            }
        });
    }]);
app.factory('UserApi', ["$resource", function($resource){
    return $resource('/api/v1/user/:id', {id:'@id'},
        {
            'updateProfile': { method:'PUT' },
            'updatePassword': { method:'PUT' },
            'updateMinecraft': { method:'PUT' },
            'me': {
                method:'GET',
                url: "/api/v1/user/me"
            },
            'meUpdateProfile': {
                method:'PUT',
                url: "/api/v1/user/me/profile"
            },
            'meUpdatePassword': {
                method:'PUT',
                url: "/api/v1/user/me/password"
            },
            'meUpdateMinecraft': {
                method:'PUT',
                url: "/api/v1/user/me/minecraft"
            }
        });
    }]);
app.controller("AdminCtrl", ["$scope", function($scope) {

    $scope.tabData   = [
        {
            heading: 'Servers',
            route:   'servers'
        },
        {
            heading: 'Subscriptions',
            route:   'subscriptions'
        },
        {
            heading: 'Users',
            route:   'users'
        },
        {
            heading: 'Roles',
            route:   'roles'
        }
    ];


}]).config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    //
    // Now set up the states
    $stateProvider.state('servers', {
        url: '/servers',
        templateUrl: '/partials/admin/servers.html',
        controller: 'ServerIndexCtrl'
    })
        .state('servers.detail', {
            url: "^/servers/:id",
            views: {
                '@': {
                    templateUrl: '/partials/admin/servers.detail.html',
                    controller: 'ServerDetailCtrl'
                }
            }})
        .state('subscriptions', {
        url: '/subscriptions',
        templateUrl: '/partials/admin/subscriptions.html'
    })
        .state('users', {
        url: '/users',
        templateUrl: '/partials/admin/users.html'
    })
        .state('roles', {
        url: '/roles',
        templateUrl: '/partials/admin/roles.html'
    });

}]);
app.controller("ServerIndexCtrl", ["$scope", "$modal", "$filter", "ServersApi", function($scope, $modal, $filter, ServersApi) {


    var refreshData = function () {
        $scope.myPromise = ServersApi.get(function(data) {
            $scope.servers = data.data;
            $scope.showTableContent = true;
        });
    };
    refreshData();

    $scope.$watch('servers', function(newValue, oldValue) {
        angular.forEach($scope.servers, function(server){
            ServersApi.online({id:server.id},function(data) {
                server.online = data.data;
            });

        });

    });

    $scope.open = function (serverEditID) {
        var modalInstance = $modal.open({
            templateUrl: 'AddServerModal.html',
            controller: 'ModalInstanceCtrl',
            resolve: {
                ResourcesApi: function () {
                    return  ServersApi;
                },
                recordID: function () {
                    return  serverEditID;
                }
            }
        });

        modalInstance.result.then(function (data) {
            refreshData();
        }, function () {
        });
    };

}]);
app.controller("ServerDetailCtrl", ["$scope", "$state", "$stateParams", "$filter", "ServersApi", function($scope, $state, $stateParams, $filter, ServersApi) {

    $scope.myPromise =  ServersApi.get({id:$stateParams.id}, function(data) {
        $scope.resource = data.data;
    });


}]);
app.controller('ModalInstanceCtrl', ["$scope", "$modalInstance", "ResourcesApi", "recordID", function ($scope, $modalInstance, ResourcesApi, recordID) {

    if (recordID) {
        $scope.myPromise =  ResourcesApi.get({id:recordID}, function(data) {
            $scope.resource = data.data;
            $scope.showModalContent = true;
        });
    }
    else {
        $scope.showModalContent = true;
    }

    $scope.ok = function () {
        if(recordID){
            ResourcesApi.update({ id:$scope.resource.id }, $scope.resource, function(res) {
                $modalInstance.close($scope.resource);
            }, function(res) {
                $scope.errorResponse = res.data.error.message;
            });
        } else {
            console.log("2");
            ResourcesApi.save( $scope.resource, function(res) {
                $modalInstance.close($scope.resource);
            }, function(res) {
                $scope.errorResponse = res.data.error.message;
            });
        }

    };

    $scope.cancel = function () {
        $modalInstance.dismiss('cancel');
    };
}]);
app.controller("MinecraftIndexCtrl", ["$scope", "$modal", "$filter", "UserApi", function($scope, $modal, $filter, UserApi) {

    var refreshData = function () {
        $scope.myPromise = UserApi.me(function(data) {
            $scope.resource = data.data;
            $scope.showTableContent = true;
        });
    };
    refreshData();

    $scope.saveMinecraft = function () {
        UserApi.meUpdateMinecraft($scope.resource, function(res) {
            $scope.successMinecraftResponse = res;
            $scope.errorResponse = null;
        }, function(res) {
            $scope.errorResponse = res.data.error.message;
        });
    };


}]);
app.controller("ProfileCtrl", ["$scope", function($scope) {

    $scope.tabData   = [
        {
            heading: 'Profile',
            route:   'profile'
        },
        {
            heading: 'Minecraft',
            route:   'minecraft'
        }
    ];


}]).config(["$stateProvider", "$urlRouterProvider", function($stateProvider, $urlRouterProvider) {
    //
    // For any unmatched url, redirect to /state1
    $urlRouterProvider.otherwise("/profile");
    //
    // Now set up the states
    $stateProvider.state('profile', {
        url: '/profile',
        templateUrl: '/partials/profile/profile.html'
    }).state('minecraft', {
        url: '/minecraft',
        templateUrl: '/partials/profile/minecraft.html'
    });

}]);
app.controller("ProfileIndexCtrl", ["$scope", "$modal", "$filter", "UserApi", function($scope, $modal, $filter, UserApi) {

    var refreshData = function () {
        $scope.myPromise = UserApi.me(function(data) {
            $scope.resource = data.data;
            $scope.showTableContent = true;
        });
    };
    refreshData();

    $scope.saveProfile = function () {
        UserApi.meUpdateProfile($scope.resource, function(res) {
            $scope.successProfileResponse = res;
            $scope.errorResponse = null;
        }, function(res) {
            $scope.errorResponse = res.data.error.message;
        });
    };

    $scope.savePassword = function () {
        UserApi.meUpdatePassword($scope.resource, function(res) {
            $scope.successPasswordResponse = res;
            $scope.errorResponse = null;
        }, function(res) {
            $scope.errorResponse = res.data.error.message;
        });
    };


}]);
app.controller('NavbarInstanceCtrl', ["$scope", function ($scope) {
}]);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImFwcC5qcyIsIlNlcnZpY2VzL1NlcnZlclNlcnZpY2UuanMiLCJTZXJ2aWNlcy9Vc2VyU2VydmljZS5qcyIsIkNvbnRyb2xsZXJzL0FkbWluaXN0cmF0aW9uL0FkbWluaXN0cmF0aW9uQ29udHJvbGxlci5qcyIsIkNvbnRyb2xsZXJzL0FkbWluaXN0cmF0aW9uL1NlcnZlckNvbnRyb2xsZXIuanMiLCJDb250cm9sbGVycy9BZG1pbmlzdHJhdGlvbi9TZXJ2ZXJEZXRhaWxDb250cm9sbGVyLmpzIiwiQ29udHJvbGxlcnMvQ29tbW9uL01vZGFsc0NvbnRyb2xsZXIuanMiLCJDb250cm9sbGVycy9Qcm9maWxlL01pbmVjcmFmdEluZGV4Q3RybC5qcyIsIkNvbnRyb2xsZXJzL1Byb2ZpbGUvUHJvZmlsZUNvbnRyb2xsZXIuanMiLCJDb250cm9sbGVycy9Qcm9maWxlL1Byb2ZpbGVJbmRleEN0cmwuanMiLCJDb250cm9sbGVycy9SZWdpb25zL05hdmJhckNvbnRyb2xsZXIuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsSUFBQSxNQUFBLFFBQUEsT0FBQSxTQUFBO0lBQ0E7SUFDQTtJQUNBO0lBQ0E7SUFDQTs7OztLQUlBLGdDQUFBLFVBQUEsc0JBQUE7UUFDQSxxQkFBQSxZQUFBO1FBQ0EscUJBQUEsVUFBQTs7S0FFQSxNQUFBLGlCQUFBO1FBQ0EsUUFBQTtRQUNBLFVBQUE7UUFDQSxhQUFBO1FBQ0EsT0FBQTtRQUNBLGFBQUE7UUFDQSxjQUFBOztBQ25CQSxJQUFBLFFBQUEsNEJBQUEsU0FBQSxVQUFBO0lBQ0EsT0FBQSxVQUFBLHNCQUFBLENBQUEsR0FBQTtRQUNBO1lBQ0EsVUFBQSxFQUFBLE9BQUE7WUFDQSxVQUFBO2dCQUNBLE9BQUE7Z0JBQ0EsS0FBQTs7OztBQ05BLElBQUEsUUFBQSx5QkFBQSxTQUFBLFVBQUE7SUFDQSxPQUFBLFVBQUEsb0JBQUEsQ0FBQSxHQUFBO1FBQ0E7WUFDQSxpQkFBQSxFQUFBLE9BQUE7WUFDQSxrQkFBQSxFQUFB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Q29udGVudCI6WyJ2YXIgYXBwID0gYW5ndWxhci5tb2R1bGUoJ21jVUFQJywgW1xyXG4gICAgJ25nUmVzb3VyY2UnLFxyXG4gICAgJ3VpLmJvb3RzdHJhcCcsXHJcbiAgICAndWkucm91dGVyLnRhYnMnLFxyXG4gICAgJ3VpLnJvdXRlcicsXHJcbiAgICAnY2dCdXN5J1xyXG4gICAgXSlcclxuXHJcblxyXG4gICAgLmNvbmZpZyhmdW5jdGlvbiAoJGludGVycG9sYXRlUHJvdmlkZXIpIHtcclxuICAgICAgICAkaW50ZXJwb2xhdGVQcm92aWRlci5zdGFydFN5bWJvbCgnW1snKTtcclxuICAgICAgICAkaW50ZXJwb2xhdGVQcm92aWRlci5lbmRTeW1ib2woJ11dJyk7XHJcbiAgICB9KVxyXG4gICAgLnZhbHVlKCdjZ0J1c3lEZWZhdWx0cycse1xyXG4gICAgICAgIG1lc3NhZ2U6J0xvYWRpbmcgRGF0YScsXHJcbiAgICAgICAgYmFja2Ryb3A6IGZhbHNlLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2NvbW1vbi9hbmd1bGFyLWJ1c3kuaHRtbCcsXHJcbiAgICAgICAgZGVsYXk6IDAsXHJcbiAgICAgICAgbWluRHVyYXRpb246IDEwMCxcclxuICAgICAgICB3cmFwcGVyQ2xhc3M6ICdteS1jbGFzcyBteS1jbGFzczInXHJcbiAgICB9KTsiLCJhcHAuZmFjdG9yeSgnU2VydmVyc0FwaScsIGZ1bmN0aW9uKCRyZXNvdXJjZSl7XHJcbiAgICByZXR1cm4gJHJlc291cmNlKCcvYXBpL3YxL3NlcnZlci86aWQnLCB7aWQ6J0BpZCd9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgJ3VwZGF0ZSc6IHsgbWV0aG9kOidQVVQnIH0sXHJcbiAgICAgICAgICAgICdvbmxpbmUnOiB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6J0dFVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IFwiL2FwaS92MS9zZXJ2ZXIvOmlkL29ubGluZVwiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pOyIsImFwcC5mYWN0b3J5KCdVc2VyQXBpJywgZnVuY3Rpb24oJHJlc291cmNlKXtcclxuICAgIHJldHVybiAkcmVzb3VyY2UoJy9hcGkvdjEvdXNlci86aWQnLCB7aWQ6J0BpZCd9LFxyXG4gICAgICAgIHtcclxuICAgICAgICAgICAgJ3VwZGF0ZVByb2ZpbGUnOiB7IG1ldGhvZDonUFVUJyB9LFxyXG4gICAgICAgICAgICAndXBkYXRlUGFzc3dvcmQnOiB7IG1ldGhvZDonUFVUJyB9LFxyXG4gICAgICAgICAgICAndXBkYXRlTWluZWNyYWZ0JzogeyBtZXRob2Q6J1BVVCcgfSxcclxuICAgICAgICAgICAgJ21lJzoge1xyXG4gICAgICAgICAgICAgICAgbWV0aG9kOidHRVQnLFxyXG4gICAgICAgICAgICAgICAgdXJsOiBcIi9hcGkvdjEvdXNlci9tZVwiXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdtZVVwZGF0ZVByb2ZpbGUnOiB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6J1BVVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IFwiL2FwaS92MS91c2VyL21lL3Byb2ZpbGVcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnbWVVcGRhdGVQYXNzd29yZCc6IHtcclxuICAgICAgICAgICAgICAgIG1ldGhvZDonUFVUJyxcclxuICAgICAgICAgICAgICAgIHVybDogXCIvYXBpL3YxL3VzZXIvbWUvcGFzc3dvcmRcIlxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnbWVVcGRhdGVNaW5lY3JhZnQnOiB7XHJcbiAgICAgICAgICAgICAgICBtZXRob2Q6J1BVVCcsXHJcbiAgICAgICAgICAgICAgICB1cmw6IFwiL2FwaS92MS91c2VyL21lL21pbmVjcmFmdFwiXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgIH0pOyIsImFwcC5jb250cm9sbGVyKFwiQWRtaW5DdHJsXCIsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG5cclxuICAgICRzY29wZS50YWJEYXRhICAgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoZWFkaW5nOiAnU2VydmVycycsXHJcbiAgICAgICAgICAgIHJvdXRlOiAgICdzZXJ2ZXJzJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoZWFkaW5nOiAnU3Vic2NyaXB0aW9ucycsXHJcbiAgICAgICAgICAgIHJvdXRlOiAgICdzdWJzY3JpcHRpb25zJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoZWFkaW5nOiAnVXNlcnMnLFxyXG4gICAgICAgICAgICByb3V0ZTogICAndXNlcnMnXHJcbiAgICAgICAgfSxcclxuICAgICAgICB7XHJcbiAgICAgICAgICAgIGhlYWRpbmc6ICdSb2xlcycsXHJcbiAgICAgICAgICAgIHJvdXRlOiAgICdyb2xlcydcclxuICAgICAgICB9XHJcbiAgICBdO1xyXG5cclxuXHJcbn0pLmNvbmZpZyhmdW5jdGlvbigkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbiAgICAvL1xyXG4gICAgLy8gTm93IHNldCB1cCB0aGUgc3RhdGVzXHJcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnc2VydmVycycsIHtcclxuICAgICAgICB1cmw6ICcvc2VydmVycycsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYWRtaW4vc2VydmVycy5odG1sJyxcclxuICAgICAgICBjb250cm9sbGVyOiAnU2VydmVySW5kZXhDdHJsJ1xyXG4gICAgfSlcclxuICAgICAgICAuc3RhdGUoJ3NlcnZlcnMuZGV0YWlsJywge1xyXG4gICAgICAgICAgICB1cmw6IFwiXi9zZXJ2ZXJzLzppZFwiLFxyXG4gICAgICAgICAgICB2aWV3czoge1xyXG4gICAgICAgICAgICAgICAgJ0AnOiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYWRtaW4vc2VydmVycy5kZXRhaWwuaHRtbCcsXHJcbiAgICAgICAgICAgICAgICAgICAgY29udHJvbGxlcjogJ1NlcnZlckRldGFpbEN0cmwnXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH19KVxyXG4gICAgICAgIC5zdGF0ZSgnc3Vic2NyaXB0aW9ucycsIHtcclxuICAgICAgICB1cmw6ICcvc3Vic2NyaXB0aW9ucycsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYWRtaW4vc3Vic2NyaXB0aW9ucy5odG1sJ1xyXG4gICAgfSlcclxuICAgICAgICAuc3RhdGUoJ3VzZXJzJywge1xyXG4gICAgICAgIHVybDogJy91c2VycycsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvYWRtaW4vdXNlcnMuaHRtbCdcclxuICAgIH0pXHJcbiAgICAgICAgLnN0YXRlKCdyb2xlcycsIHtcclxuICAgICAgICB1cmw6ICcvcm9sZXMnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL2FkbWluL3JvbGVzLmh0bWwnXHJcbiAgICB9KTtcclxuXHJcbn0pOyIsImFwcC5jb250cm9sbGVyKFwiU2VydmVySW5kZXhDdHJsXCIsIGZ1bmN0aW9uKCRzY29wZSwgJG1vZGFsLCAkZmlsdGVyLCBTZXJ2ZXJzQXBpKSB7XHJcblxyXG5cclxuICAgIHZhciByZWZyZXNoRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkc2NvcGUubXlQcm9taXNlID0gU2VydmVyc0FwaS5nZXQoZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAkc2NvcGUuc2VydmVycyA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dUYWJsZUNvbnRlbnQgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJlZnJlc2hEYXRhKCk7XHJcblxyXG4gICAgJHNjb3BlLiR3YXRjaCgnc2VydmVycycsIGZ1bmN0aW9uKG5ld1ZhbHVlLCBvbGRWYWx1ZSkge1xyXG4gICAgICAgIGFuZ3VsYXIuZm9yRWFjaCgkc2NvcGUuc2VydmVycywgZnVuY3Rpb24oc2VydmVyKXtcclxuICAgICAgICAgICAgU2VydmVyc0FwaS5vbmxpbmUoe2lkOnNlcnZlci5pZH0sZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgc2VydmVyLm9ubGluZSA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH0pO1xyXG5cclxuICAgICRzY29wZS5vcGVuID0gZnVuY3Rpb24gKHNlcnZlckVkaXRJRCkge1xyXG4gICAgICAgIHZhciBtb2RhbEluc3RhbmNlID0gJG1vZGFsLm9wZW4oe1xyXG4gICAgICAgICAgICB0ZW1wbGF0ZVVybDogJ0FkZFNlcnZlck1vZGFsLmh0bWwnLFxyXG4gICAgICAgICAgICBjb250cm9sbGVyOiAnTW9kYWxJbnN0YW5jZUN0cmwnLFxyXG4gICAgICAgICAgICByZXNvbHZlOiB7XHJcbiAgICAgICAgICAgICAgICBSZXNvdXJjZXNBcGk6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIFNlcnZlcnNBcGk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgcmVjb3JkSUQ6IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gIHNlcnZlckVkaXRJRDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBtb2RhbEluc3RhbmNlLnJlc3VsdC50aGVuKGZ1bmN0aW9uIChkYXRhKSB7XHJcbiAgICAgICAgICAgIHJlZnJlc2hEYXRhKCk7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcbn0pOyIsImFwcC5jb250cm9sbGVyKFwiU2VydmVyRGV0YWlsQ3RybFwiLCBmdW5jdGlvbigkc2NvcGUsICRzdGF0ZSwgJHN0YXRlUGFyYW1zLCAkZmlsdGVyLCBTZXJ2ZXJzQXBpKSB7XHJcblxyXG4gICAgJHNjb3BlLm15UHJvbWlzZSA9ICBTZXJ2ZXJzQXBpLmdldCh7aWQ6JHN0YXRlUGFyYW1zLmlkfSwgZnVuY3Rpb24oZGF0YSkge1xyXG4gICAgICAgICRzY29wZS5yZXNvdXJjZSA9IGRhdGEuZGF0YTtcclxuICAgIH0pO1xyXG5cclxuXHJcbn0pOyIsImFwcC5jb250cm9sbGVyKCdNb2RhbEluc3RhbmNlQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUsICRtb2RhbEluc3RhbmNlLCBSZXNvdXJjZXNBcGksIHJlY29yZElEKSB7XHJcblxyXG4gICAgaWYgKHJlY29yZElEKSB7XHJcbiAgICAgICAgJHNjb3BlLm15UHJvbWlzZSA9ICBSZXNvdXJjZXNBcGkuZ2V0KHtpZDpyZWNvcmRJRH0sIGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc291cmNlID0gZGF0YS5kYXRhO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd01vZGFsQ29udGVudCA9IHRydWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICAkc2NvcGUuc2hvd01vZGFsQ29udGVudCA9IHRydWU7XHJcbiAgICB9XHJcblxyXG4gICAgJHNjb3BlLm9rID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGlmKHJlY29yZElEKXtcclxuICAgICAgICAgICAgUmVzb3VyY2VzQXBpLnVwZGF0ZSh7IGlkOiRzY29wZS5yZXNvdXJjZS5pZCB9LCAkc2NvcGUucmVzb3VyY2UsIGZ1bmN0aW9uKHJlcykge1xyXG4gICAgICAgICAgICAgICAgJG1vZGFsSW5zdGFuY2UuY2xvc2UoJHNjb3BlLnJlc291cmNlKTtcclxuICAgICAgICAgICAgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAkc2NvcGUuZXJyb3JSZXNwb25zZSA9IHJlcy5kYXRhLmVycm9yLm1lc3NhZ2U7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiMlwiKTtcclxuICAgICAgICAgICAgUmVzb3VyY2VzQXBpLnNhdmUoICRzY29wZS5yZXNvdXJjZSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICAgICAkbW9kYWxJbnN0YW5jZS5jbG9zZSgkc2NvcGUucmVzb3VyY2UpO1xyXG4gICAgICAgICAgICB9LCBmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgICAgICRzY29wZS5lcnJvclJlc3BvbnNlID0gcmVzLmRhdGEuZXJyb3IubWVzc2FnZTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgIH07XHJcblxyXG4gICAgJHNjb3BlLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkbW9kYWxJbnN0YW5jZS5kaXNtaXNzKCdjYW5jZWwnKTtcclxuICAgIH07XHJcbn0pOyIsImFwcC5jb250cm9sbGVyKFwiTWluZWNyYWZ0SW5kZXhDdHJsXCIsIGZ1bmN0aW9uKCRzY29wZSwgJG1vZGFsLCAkZmlsdGVyLCBVc2VyQXBpKSB7XHJcblxyXG4gICAgdmFyIHJlZnJlc2hEYXRhID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICRzY29wZS5teVByb21pc2UgPSBVc2VyQXBpLm1lKGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnJlc291cmNlID0gZGF0YS5kYXRhO1xyXG4gICAgICAgICAgICAkc2NvcGUuc2hvd1RhYmxlQ29udGVudCA9IHRydWU7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9O1xyXG4gICAgcmVmcmVzaERhdGEoKTtcclxuXHJcbiAgICAkc2NvcGUuc2F2ZU1pbmVjcmFmdCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBVc2VyQXBpLm1lVXBkYXRlTWluZWNyYWZ0KCRzY29wZS5yZXNvdXJjZSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5zdWNjZXNzTWluZWNyYWZ0UmVzcG9uc2UgPSByZXM7XHJcbiAgICAgICAgICAgICRzY29wZS5lcnJvclJlc3BvbnNlID0gbnVsbDtcclxuICAgICAgICB9LCBmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLmVycm9yUmVzcG9uc2UgPSByZXMuZGF0YS5lcnJvci5tZXNzYWdlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuXHJcblxyXG59KTsiLCJhcHAuY29udHJvbGxlcihcIlByb2ZpbGVDdHJsXCIsIGZ1bmN0aW9uKCRzY29wZSkge1xyXG5cclxuICAgICRzY29wZS50YWJEYXRhICAgPSBbXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoZWFkaW5nOiAnUHJvZmlsZScsXHJcbiAgICAgICAgICAgIHJvdXRlOiAgICdwcm9maWxlJ1xyXG4gICAgICAgIH0sXHJcbiAgICAgICAge1xyXG4gICAgICAgICAgICBoZWFkaW5nOiAnTWluZWNyYWZ0JyxcclxuICAgICAgICAgICAgcm91dGU6ICAgJ21pbmVjcmFmdCdcclxuICAgICAgICB9XHJcbiAgICBdO1xyXG5cclxuXHJcbn0pLmNvbmZpZyhmdW5jdGlvbigkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XHJcbiAgICAvL1xyXG4gICAgLy8gRm9yIGFueSB1bm1hdGNoZWQgdXJsLCByZWRpcmVjdCB0byAvc3RhdGUxXHJcbiAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKFwiL3Byb2ZpbGVcIik7XHJcbiAgICAvL1xyXG4gICAgLy8gTm93IHNldCB1cCB0aGUgc3RhdGVzXHJcbiAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgncHJvZmlsZScsIHtcclxuICAgICAgICB1cmw6ICcvcHJvZmlsZScsXHJcbiAgICAgICAgdGVtcGxhdGVVcmw6ICcvcGFydGlhbHMvcHJvZmlsZS9wcm9maWxlLmh0bWwnXHJcbiAgICB9KS5zdGF0ZSgnbWluZWNyYWZ0Jywge1xyXG4gICAgICAgIHVybDogJy9taW5lY3JhZnQnLFxyXG4gICAgICAgIHRlbXBsYXRlVXJsOiAnL3BhcnRpYWxzL3Byb2ZpbGUvbWluZWNyYWZ0Lmh0bWwnXHJcbiAgICB9KTtcclxuXHJcbn0pOyIsImFwcC5jb250cm9sbGVyKFwiUHJvZmlsZUluZGV4Q3RybFwiLCBmdW5jdGlvbigkc2NvcGUsICRtb2RhbCwgJGZpbHRlciwgVXNlckFwaSkge1xyXG5cclxuICAgIHZhciByZWZyZXNoRGF0YSA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkc2NvcGUubXlQcm9taXNlID0gVXNlckFwaS5tZShmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5yZXNvdXJjZSA9IGRhdGEuZGF0YTtcclxuICAgICAgICAgICAgJHNjb3BlLnNob3dUYWJsZUNvbnRlbnQgPSB0cnVlO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfTtcclxuICAgIHJlZnJlc2hEYXRhKCk7XHJcblxyXG4gICAgJHNjb3BlLnNhdmVQcm9maWxlID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIFVzZXJBcGkubWVVcGRhdGVQcm9maWxlKCRzY29wZS5yZXNvdXJjZSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5zdWNjZXNzUHJvZmlsZVJlc3BvbnNlID0gcmVzO1xyXG4gICAgICAgICAgICAkc2NvcGUuZXJyb3JSZXNwb25zZSA9IG51bGw7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5lcnJvclJlc3BvbnNlID0gcmVzLmRhdGEuZXJyb3IubWVzc2FnZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG4gICAgJHNjb3BlLnNhdmVQYXNzd29yZCA9IGZ1bmN0aW9uICgpIHtcclxuICAgICAgICBVc2VyQXBpLm1lVXBkYXRlUGFzc3dvcmQoJHNjb3BlLnJlc291cmNlLCBmdW5jdGlvbihyZXMpIHtcclxuICAgICAgICAgICAgJHNjb3BlLnN1Y2Nlc3NQYXNzd29yZFJlc3BvbnNlID0gcmVzO1xyXG4gICAgICAgICAgICAkc2NvcGUuZXJyb3JSZXNwb25zZSA9IG51bGw7XHJcbiAgICAgICAgfSwgZnVuY3Rpb24ocmVzKSB7XHJcbiAgICAgICAgICAgICRzY29wZS5lcnJvclJlc3BvbnNlID0gcmVzLmRhdGEuZXJyb3IubWVzc2FnZTtcclxuICAgICAgICB9KTtcclxuICAgIH07XHJcblxyXG5cclxufSk7IiwiYXBwLmNvbnRyb2xsZXIoJ05hdmJhckluc3RhbmNlQ3RybCcsIGZ1bmN0aW9uICgkc2NvcGUpIHtcclxufSk7Il0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9